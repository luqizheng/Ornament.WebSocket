<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="reconnecting-websocket.js"></script>
</head>
<body>
    <div id="screen" style="background: black; color: #fff; height: 300px; width: 100%;">

    </div>


    <input type="file" name="file" id="file" />
    <button id="upload" onclick="Uploader()">upload</button>
    <script type="text/javascript">

        var ws = new ReconnectingWebSocket('ws://localhost:52470/uploadFile');

        ws.onopen = function (msg) {
            setText("连接上服务器");

        };
        ws.onclose = function (msg) {
            setText("断开服务器");
        };
        ws.onmessage = function (msg) {
            setText(msg.data);
        };
        function setText(text) {
            var d = document.getElementById("screen");
            d.innerHTML += "<br>" + text;
        }
        function Uploader() {
            var file = document.getElementById("file");
            var reader = new FileReader();
            reader.onload = function () {
                var arrayBuffer = reader.result;
                ws.send(arrayBuffer);
              
            };
            reader.readAsArrayBuffer(file.files[0]);
        

        }

        function FileSlicer(file) {
            // randomly picked 1MB slices,
            // I don't think this size is important for this experiment
            this.sliceSize = 1024 * 1024;
            this.slices = Math.ceil(file.size / this.sliceSize);

            this.currentSlice = 0;

            this.getNextSlice = function () {
                var start = this.currentSlice * this.sliceSize;
                var end = Math.min((this.currentSlice + 1) * this.sliceSize, file.size);
                ++this.currentSlice;

                return file.slice(start, end);
            }
        }
    </script>

    <script>


        // Check for the various File API support.
        if (window.File && window.FileReader && window.FileList
                          && window.Blob) {
            // Great success! All the File APIs are supported.
        } else {
            alert('The File APIs are not fully supported in this browser.');
        }

    </script>
</body>

</html>